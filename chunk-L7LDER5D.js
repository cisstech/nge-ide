import{a as Te,b as Re,c as ke,g as j,h as je,i as ze}from"./chunk-2KPDQHY7.js";import{b as Be,c as Ae,d as z,e as Ve,f as $e}from"./chunk-HXY2ZCR4.js";import{k as Oe}from"./chunk-XO3YPVKL.js";import{Da as we,Ea as k,Fa as Ee,Ha as Fe,Ia as Ne,M as ge,Oa as Pe,P as ye,Pa as Me,Q as Se,R as _e,S as Ce,U as xe,W as T,Z as be,ba as f,bb as De,da as L,db as Ie,ea as R}from"./chunk-THU2NYFJ.js";import{$b as pe,Aa as ne,Ba as oe,Cb as H,Da as se,Hb as C,Ib as x,Jb as b,Ka as V,Kb as D,La as $,Lb as I,Nb as U,Oc as me,Pb as O,Pc as fe,Rb as F,Ua as ae,Vb as Q,Vc as ue,Wb as K,Wc as ve,Xb as W,Yb as le,Zb as de,a as Z,b as ee,cb as ce,eb as h,fb as m,hc as he,i as w,mc as g,nc as N,o as ie,oc as q,p as P,qa as te,ra as re,ub as _,va as E,wb as c}from"./chunk-PL3RMG6N.js";var He=(()=>{let t=class t{get fileNestingPatterns(){return this.fileNestingPatternsRegistry.value}get tree(){return this.treeService.get(this.adapter.id)}get onDidContextMenu(){return this.contextMenu.asObservable()}constructor(e,i,n,a,l){this.treeService=e,this.fileService=i,this.editorService=n,this.commandService=a,this.notificationService=l,this.id="workbench.contrib.explorer-service",this.contextMenu=new ie,this.commandRegistry=new P([]),this.fileNestingPatternsRegistry=new P([]),this.clipboardData=[],this.root=this.fileService.treeChange,this.adapter={id:"explorer.tree",idProvider:o=>this.fileService.entryId(o.uri),nameProvider:o=>this.fileService.entryName(o.uri),childrenProvider:o=>{let p=o;if(p.isFolder)p.children=[];else return p.children;let d=this.fileService.findChildren(o).map(u=>ee(Z({},u),{parent:o})),y=[];try{d.forEach(u=>{let B=this.fileService.entryName(u.uri),S,A;for(let M of this.fileNestingPatterns)if(S=B.match(M.parent),S){A=M;break}if(S&&A){let M=A.children.map(v=>(v=(S==null?void 0:S.length)===2?v.replace("${capture}",S[1]):v,new RegExp(v))),X=d.filter(v=>{let Y=this.fileService.entryName(v.uri);return B===Y?!1:M.some(Ke=>Y.match(Ke))});u.children=X,X.forEach(v=>{y.push(this.fileService.entryId(v.uri))})}})}catch(u){console.error(u)}let J=o;return J.children=d.filter(u=>!y.includes(this.fileService.entryId(u.uri))),J.children},isExpandable:o=>{var d;let p=o;return p.isFolder?!0:!!((d=p.children)!=null&&d.length)},onDidEditName:this.onEditNode.bind(this),keepStateOnChangeNodes:!0,enableKeyboardFiltering:!1,actions:{mouse:{click:this.onMouseDown.bind(this),rightClick:this.onContextMenu.bind(this)},keys:{c:this.onCopy.bind(this),v:this.onPaste.bind(this),Enter:o=>{o.node&&this.tree.startEdition(o.node)}}}}}refresh(){this.fileService.refresh()}deactivate(){this.clipboardData=[],this.commandRegistry.next([]),this.fileNestingPatternsRegistry.next([])}registerFileNestingPatterns(...e){this.fileNestingPatternsRegistry.next([...this.fileNestingPatternsRegistry.value,...e]),this.fileService.emitTreeChange()}unregisterFileNestingPatterns(...e){this.fileNestingPatternsRegistry.next([...this.fileNestingPatternsRegistry.value.filter(i=>!e.includes(i.id))]),this.fileService.emitTreeChange()}registerCommands(...e){this.commandRegistry.next([...this.commandRegistry.value,...e.map(i=>typeof i=="function"?this.commandService.find(i):i)])}unregisterCommands(...e){this.commandRegistry.next([...this.commandRegistry.value.filter(i=>!e.includes(i.id))])}listCommands(){let i=this.commandRegistry.value.reduce((n,a)=>(n[a.group]=n[a.group]||[],a.enabled&&n[a.group].push(a),n),{});return Object.keys(i).sort().map(n=>i[n]).filter(n=>n.length)}selections(){var e;return this.fileService.normalize(((e=this.tree)==null?void 0:e.selections())||[])}focusedNode(){var e;return(e=this.tree)==null?void 0:e.focusedNode()}expand(e){var i;(i=this.tree)==null||i.expand(e)}expandAll(){var e;(e=this.tree)==null||e.expandAll()}collapse(e){var i;(i=this.tree)==null||i.collapse(e)}collapseAll(){var e;(e=this.tree)==null||e.collapseAll()}hasSelection(){var e,i;return!!((i=(e=this.tree)==null?void 0:e.selections())!=null&&i.length)}canCopy(){let e=this.selections();if(!e.length)return!1;let i=e[0];return this.fileService.hasCapability(i.uri,f.FileMove)?e.every(n=>n.uri.scheme===i.uri.scheme&&!this.fileService.isRoot(n.uri)):!1}copy(){this.clipboardData=[],this.canCopy()&&(this.clipboardData=this.selections())}canPaste(){let e=this.focusedNode();if(!e||!this.clipboardData.length)return!1;let i=this.clipboardData[0];return this.fileService.hasCapability(i.uri,f.FileMove)?i.uri.scheme===e.uri.scheme&&e.isFolder&&!e.readOnly:!1}paste(){this.canPaste()&&this.fileService.copy(this.clipboardData,this.focusedNode()).catch(e=>{this.notificationService.publishError(e)})}canDelete(){let e=this.selections();return e.length?e.every(i=>!i.readOnly&&!this.fileService.isRoot(i.uri)&&this.fileService.hasCapability(i.uri,f.FileDelete)):!1}canCreateFile(){let e=this.focusedNode();return e!=null&&e.readOnly||!(e!=null&&e.isFolder)?!1:this.fileService.hasCapability(e.uri,f.FileWrite)}createFile(){return w(this,null,function*(){this.canCreateFile()&&(this.newFileType="file",this.tree.startEdition(this.focusedNode(),!0))})}createFolder(){return w(this,null,function*(){this.canCreateFile()&&(this.newFileType="folder",this.tree.startEdition(this.focusedNode(),!0))})}canDownload(){var e;return!!((e=this.focusedNode())!=null&&e.url)}download(){this.canDownload()&&window.open(this.focusedNode().url,"_blank")}canUpload(){let e=this.focusedNode();return!e||!this.fileService.hasCapability(e.uri,f.FileUpload)?!1:e.isFolder&&!e.readOnly}uploadFiles(e){this.canUpload()&&this.fileService.upload(e,this.focusedNode()).catch(i=>{this.notificationService.publishError(i)})}canEdit(){let e=this.focusedNode();return!e||!this.fileService.hasCapability(e.uri,f.FileWrite)?!1:!e.readOnly&&!this.fileService.isRoot(e.uri)}startEdit(){var e;this.canEdit()&&((e=this.tree)==null||e.startEdition(this.focusedNode()))}onCopy(e){let{event:i}=e;(i.metaKey||i.ctrlKey)&&(i.preventDefault(),i.stopPropagation(),this.copy())}onPaste(e){let{event:i}=e;(i.metaKey||i.ctrlKey)&&(i.preventDefault(),i.stopPropagation(),this.paste())}onMouseDown(e){let{node:i}=e;i&&!i.isFolder&&this.editorService.open(e.node.uri).catch(n=>{this.notificationService.publishError(n)})}onContextMenu(e){this.contextMenu.next(e)}onEditNode(e){return w(this,null,function*(){let{node:i,text:n,creation:a}=e;try{a?this.newFileType==="file"?yield this.fileService.createFile(i,n):yield this.fileService.createDirectory(i,n):yield this.fileService.rename(i,n),this.tree.endEdition()}catch(l){this.notificationService.publishError(l)}})}};t.\u0275fac=function(i){return new(i||t)(E($e),E(R),E(k),E(be),E(T))},t.\u0275prov=te({token:t,factory:t.\u0275fac});let r=t;return r})();var Ue=(()=>{let t=class t{transform(e){return{alt:e.name,isRoot:e.level===0,expanded:e.expanded,isDirectory:e.expandable&&e.data.isFolder}}};t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=se({name:"explorerFileIconOptions",type:t,pure:!0,standalone:!0});let r=t;return r})();var Je=()=>[];function Xe(r,t){r&1&&b(0,"div",12)}function Ye(r,t){r&1&&(b(0,"ui-icon",13),g(1,"iconCodicon")),r&2&&c("icon",N(1,1,"chevron-down"))}function Ze(r,t){r&1&&(b(0,"ui-icon",13),g(1,"iconCodicon")),r&2&&c("icon",N(1,1,"chevron-right"))}function ei(r,t){if(r&1&&_(0,Ye,2,3,"ui-icon",13)(1,Ze,2,3,"ui-icon",13),r&2){let s=F().$implicit;H(s.expanded?0:1)}}function ii(r,t){if(r&1&&(b(0,"ui-icon",14),g(1,"iconFile")),r&2){let s=t.ngIf,e=F().$implicit;c("icon",q(1,1,e.name,s))}}function ti(r,t){r&1&&(C(0,"div",15),b(1,"div",16),x())}function ri(r,t){if(r&1){let s=U();D(0),_(1,Xe,1,0,"div",7)(2,ei,2,1)(3,ii,2,4,"ui-icon",8),g(4,"explorerFileIconOptions"),C(5,"div",9),g(6,"fileName"),O("dropped",function(i){V(s);let n=F();return $(n.onDropped(i))}),x(),C(7,"div",10),_(8,ti,2,0,"div",11),x(),I()}if(r&2){let s=t.$implicit;F();let e=le(1);h(),c("ngIf",!s.expandable),h(),H(s.expandable&&s.level>0?2:-1),h(),c("ngIf",N(4,8,s)),h(2),c("title",q(6,10,s.data.uri,!0))("highlight",s.name)("highlightPattern",e.filter.term)("dndData",s.id),h(3),c("ngIf",s.data.readOnly)}}function ni(r,t){if(r&1){let s=U();D(0),C(1,"li",19),O("click",function(){let i=V(s).$implicit;return $(i.execute())}),de(2),x(),I()}if(r&2){let s=t.$implicit;h(2),pe(" ",s.label," ")}}function oi(r,t){r&1&&b(0,"li",20)}function si(r,t){if(r&1&&(D(0),_(1,ni,3,1,"ng-container",17)(2,oi,1,0,"li",18),I()),r&2){let s=t.$implicit,e=t.last,i=F();h(),c("ngForOf",s)("ngForTrackBy",i.trackById),h(),c("ngIf",!e)}}var Qe=(()=>{let t=class t{constructor(e,i,n,a,l,o,p,d,y){this.ideService=e,this.elementRef=i,this.fileService=n,this.editorService=a,this.dialogService=l,this.storageService=o,this.explorerService=p,this.contextMenuService=d,this.notificationService=y,this.subscriptions=[],this.root=this.explorerService.root,this.adapter=this.explorerService.adapter,this.commands=new P([])}ngOnInit(){this.restoreState(),this.subscriptions.push(this.ideService.onBeforeStop(()=>{this.saveState()})),this.subscriptions.push(this.editorService.state.subscribe(e=>{let{activeResource:i}=e;if(i){let n=i.toString(!0);this.tree.expand(n),this.tree.focus(n)}})),this.subscriptions.push(this.explorerService.onDidContextMenu.subscribe(e=>{this.commands.next(this.explorerService.listCommands()),this.contextMenuService.create(e.event,this.dropdown)})),this.subscriptions.push(this.root.subscribe(()=>this.tree.endEdition()))}ngOnDestroy(){this.saveState(),this.subscriptions.forEach(e=>e.unsubscribe())}ngAfterViewChecked(){let e=this.elementRef.nativeElement.offsetHeight+"px";e!==this.adapter.treeHeight&&(this.adapter.treeHeight=e)}closeContextMenu(){this.commands.next([])}trackById(e,i){return i.id}onDropped(e){return w(this,null,function*(){var d;let i=e.src||((d=e.file)==null?void 0:d.name)||"",n=e.dst;if(i===n||!i||!n)return;let a=L.basename(i),[l,o]=yield Promise.all([this.fileService.find(monaco.Uri.parse(i)),this.fileService.find(monaco.Uri.parse(n))]);if(!l||this.fileService.isRoot(l.uri)||!o||!o.isFolder||o.readOnly||e.file&&!this.fileService.hasCapability(o.uri,f.FileUpload)||this.fileService.isParent(l.uri,o.uri)||this.fileService.isAncestor(o.uri,l.uri))return;let p={title:`Vous \xEAtes s\xFBr de vouloir d\xE9placer '${a}' dans '${L.basename(o.uri.path)}'?`,noTitle:"Annuler",okTitle:"D\xE9placer"};try{(yield this.dialogService.confirmAsync(p))&&(yield this.fileService.move(l||e.file,o),this.tree.expand(o))}catch(y){this.notificationService.publishError(y)}})}saveState(){this.storageService.set(this.adapter.id,this.tree.saveState()).subscribe()}restoreState(){this.storageService.get(this.adapter.id,new Ae).subscribe(e=>{this.tree.restoreState(e)})}};t.\u0275fac=function(i){return new(i||t)(m(Pe),m(ae),m(R),m(k),m(we),m(Me),m(He),m(ze),m(T))},t.\u0275cmp=ne({type:t,selectors:[["ide-explorer"]],viewQuery:function(i,n){if(i&1&&(Q(z,7),Q(j,7)),i&2){let a;K(a=W())&&(n.tree=a.first),K(a=W())&&(n.dropdown=a.first)}},hostBindings:function(i,n){i&1&&O("click",function(){return n.closeContextMenu()},!1,ce)},decls:10,vars:8,consts:[["treeRef",""],["menu","nzDropdownMenu"],["m","nzMenu"],[3,"adapter","nodes"],[4,"treeNode"],["nz-menu","","role","menu"],[4,"ngFor","ngForOf"],["style","padding-left: 12px;",4,"ngIf"],[3,"icon",4,"ngIf"],["nzTooltipPlacement","topRight","dnd","",1,"tree-label",3,"dropped","title","highlight","highlightPattern","dndData"],[1,"tree-commands"],["class","tree-command",4,"ngIf"],[2,"padding-left","12px"],[1,"tree-toggle",3,"icon"],[3,"icon"],[1,"tree-command"],[1,"codicon","codicon-lock"],[4,"ngFor","ngForOf","ngForTrackBy"],["nz-menu-divider","",4,"ngIf"],["role","menuitem","nz-menu-item","",3,"click"],["nz-menu-divider",""]],template:function(i,n){i&1&&(C(0,"ui-tree",3,0),g(2,"async"),_(3,ri,9,13,"ng-container",4),x(),C(4,"nz-dropdown-menu",null,1)(6,"ul",5,2),_(8,si,3,3,"ng-container",6),g(9,"async"),x()()),i&2&&(c("adapter",n.adapter)("nodes",N(2,3,n.root)||he(7,Je)),h(8),c("ngForOf",N(9,5,n.commands)))},dependencies:[me,fe,Re,Te,ke,j,ye,z,Be,Ee,Fe,ue,Se,_e,De,Ue],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]   .tree-node[_ngcontent-%COMP%]:hover   .tree-commands[_ngcontent-%COMP%]{visibility:visible}[_nghost-%COMP%]  .highlight{color:#0066bf}[_nghost-%COMP%]  .dnd-drag{opacity:.5}[_nghost-%COMP%]  .dnd-over{box-shadow:inset 0 0 0 2px var(--sideBar-dropBackground);background:var(--sideBar-dropBackground)}[_nghost-%COMP%]  cdk-virtual-scroll-viewport{overflow-x:hidden}.tree-label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;width:100%;height:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.tree-commands[_ngcontent-%COMP%]{position:absolute;right:8px;display:flex;align-items:center;visibility:hidden}.tree-command[_ngcontent-%COMP%]{display:inline-flex;cursor:pointer;padding:0 0 0 2px!important;font-size:14px;--icon-size: 14px}ui-icon[_ngcontent-%COMP%]{--icon-size: 16px;margin-right:4px}ui-icon.tree-toggle[_ngcontent-%COMP%]{--icon-size: 16px;margin-right:2px}"],changeDetection:0});let r=t;return r})();var Ti=(()=>{let t=class t{constructor(){this.component=Qe}};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=oe({type:t}),t.\u0275inj=re({imports:[ve,Oe,ge,je,xe,Ce,Ve,Ie,Ne]});let r=t;return r})();export{He as a,Ti as b};
